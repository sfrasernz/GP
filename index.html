<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Margin Calculator</title>

<link rel="icon" type="image/png" href="favicon.png">

<style>
:root{
  --bg:#0b1020; --muted:#a9b3d1; --text:#eaf0ff;
  --line: rgba(255,255,255,.10);
  --chip: rgba(255,255,255,.08);
  --chipOn: rgba(140,170,255,.22);
  --chipBorder: rgba(255,255,255,.14);
}

*{ box-sizing:border-box; }

body{
  margin:0;
  font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  background: radial-gradient(1200px 800px at 20% 0%, #16214a, var(--bg));
  color:var(--text);
}

.wrap{ max-width:1100px;margin:auto;padding:24px 16px 40px; }

.titleRow{
  display:flex;align-items:center;gap:12px;margin-bottom:8px;
}
.brandIcon{
  width:40px;height:40px;border-radius:12px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(0,0,0,.2);
  display:flex;align-items:center;justify-content:center;
}
.brandIcon img{ width:28px;height:28px; }

h1{ margin:0;font-size:28px; }
p.sub{ margin:0 0 18px;color:var(--muted); }

.layout{
  display:grid;
  grid-template-columns:1fr;
  gap:14px;
}
@media (min-width:980px){
  .layout{ grid-template-columns:1.15fr .85fr; }
}

.card{
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.08);
  border-radius:16px;
  padding:16px;
}

.tabs{
  display:flex;gap:8px;margin-bottom:12px;
  padding-bottom:12px;border-bottom:1px solid var(--line);
}
.tabBtn{
  border:1px solid var(--chipBorder);
  background:var(--chip);
  color:var(--text);
  padding:10px 12px;
  border-radius:999px;
  font-weight:700;
  font-size:13px;
  cursor:pointer;
}
.tabBtn[aria-selected="true"]{
  background:var(--chipOn);
  border-color:rgba(140,170,255,.45);
}

.panel{ display:none; }
.panel.active{ display:block; }

.field{ display:flex;flex-direction:column;gap:6px;margin-bottom:10px; }
label{ font-size:12px;color:var(--muted); }

.rrpMetaRow{
  display:flex;justify-content:space-between;align-items:center;
}

input{
  padding:12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(0,0,0,.20);
  color:var(--text);
  font-size:16px;
  outline:none;
  width:100%;
}

.stepBtns{
  display:flex;gap:6px;margin-top:6px;
}
.stepBtns button{
  padding:12px 12px;
  border-radius:10px;
  border:1px solid var(--chipBorder);
  background:var(--chip);
  color:var(--text);
  font-weight:700;
  cursor:pointer;
  min-width:48px;
}

.actionBtn{
  padding:10px 12px;
  border-radius:12px;
  border:1px solid var(--chipBorder);
  background:var(--chip);
  color:var(--text);
  font-weight:800;
  cursor:pointer;
}

.chipBar{ display:flex;gap:8px;flex-wrap:wrap;margin-top:8px; }
.chipBtn{
  padding:8px 10px;border-radius:999px;
  border:1px solid var(--chipBorder);
  background:var(--chip);
  font-size:12px;font-weight:900;
  cursor:pointer;
}
.chipBtn[aria-pressed="true"]{
  background:var(--chipOn);
  border-color:rgba(140,170,255,.45);
}

.tableScroll{
  overflow:auto;
  -webkit-overflow-scrolling:touch;
  max-height:520px;
  border-radius:12px;
  position:relative;
  margin-top:10px;
}

.tableScroll.scrolling thead th{
  box-shadow:0 6px 12px rgba(0,0,0,.25);
}

table{
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  border-radius:12px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.10);
}

thead th{
  position:sticky;
  top:0;
  z-index:5;
  background:#111a38;
  color:var(--muted);
  font-size:12px;
  padding:12px 10px;
  border-bottom:1px solid rgba(255,255,255,.15);
}

tbody td{
  padding:10px;
  border-bottom:1px solid rgba(255,255,255,.06);
  font-variant-numeric:tabular-nums;
}

tbody tr:nth-child(odd){
  background:rgba(255,255,255,.02);
}

tr.standard{
  background:rgba(255,215,0,.16)!important;
}
tr.standard td:first-child{
  border-left:4px solid #ffd700;
}

tr.tapped{
  background:rgba(140,170,255,.10)!important;
}

td.gpCol{ font-weight:800; }

.right{ text-align:right; }

/* MOBILE IMPROVEMENTS */
@media (max-width:520px){
  input{
    font-size:18px;
    padding:16px 14px;
    border-radius:14px;
  }
  .stepBtns button{
    padding:14px 12px;
    min-width:56px;
    font-size:14px;
    border-radius:12px;
  }
  .chipBtn{
    padding:10px 12px;
    font-size:13px;
  }
  .actionBtn{
    padding:12px 14px;
    font-size:14px;
  }
  label{
    font-size:13px;
  }
}
</style>
</head>
<body>

<div class="wrap">
<div class="titleRow">
  <div class="brandIcon">
    <img src="favicon.png">
  </div>
  <div>
    <h1>Margin Calculator</h1>
    <p class="sub">Cost ex GST · RRP inc GST · GST fixed at 15%</p>
  </div>
</div>

<div class="layout">

<div class="card">
  <div class="tabs">
    <button class="tabBtn" id="tab-cost" aria-selected="true">Cost → RRP</button>
    <button class="tabBtn" id="tab-margin">Margin → RRP</button>
  </div>

  <section class="panel active" id="panel-cost">
    <div class="field">
      <label>Cost (ex GST)</label>
      <input id="cost" type="number" inputmode="decimal">
    </div>

    <div class="field">
      <label>RRP (inc GST)</label>
      <input id="rrpInc" type="number" inputmode="decimal">
      <div class="stepBtns">
        <button data-step="-10">-10</button>
        <button data-step="-1">-1</button>
        <button data-step="1">+1</button>
        <button data-step="10">+10</button>
      </div>
    </div>

    <div style="margin-top:10px;">
      <button class="actionBtn" id="resetBtn">Reset</button>
    </div>
  </section>
</div>

<aside class="card">
  <h2 style="margin:0;font-size:16px;">GP% sensitivity</h2>

  <div class="chipBar">
    <button class="chipBtn" data-inc="auto" aria-pressed="true">Auto</button>
    <button class="chipBtn" data-inc="5">5</button>
    <button class="chipBtn" data-inc="10">10</button>
    <button class="chipBtn" data-inc="50">50</button>
  </div>

  <div class="tableScroll" id="tableScroll">
    <table>
      <thead>
        <tr>
          <th>RRP</th>
          <th class="right">GP $</th>
          <th class="right">GP%</th>
          <th class="right">Markup%</th>
        </tr>
      </thead>
      <tbody id="gpTableBody"></tbody>
    </table>
  </div>
</aside>

</div>
</div>

<script>
const GST=1.15;
const DEFAULT_MULTIPLIER=1.84;
const $=id=>document.getElementById(id);
const n=v=>Number.isFinite(+v)?+v:NaN;
const money=v=>v.toLocaleString("en-NZ",{style:"currency",currency:"NZD"});
const pct=v=>v.toFixed(2)+"%";

function calc(cost,rrp){
  const sell=rrp/GST;
  const gp=sell-cost;
  return {gp, gpPct:(gp/sell)*100, muPct:(gp/cost)*100};
}

function update(){
  const cost=n($("cost").value);
  const rrp=n($("rrpInc").value);
  const body=$("gpTableBody");
  body.innerHTML="";
  if(!cost||!rrp) return;

  for(let d=-100;d<=100;d+=10){
    const r=rrp+d;
    if(r<=0) continue;
    const t=calc(cost,r);
    body.insertAdjacentHTML("beforeend",`
      <tr data-key="${r}">
        <td>${money(r)}</td>
        <td class="right">${money(t.gp)}</td>
        <td class="right gpCol">${pct(t.gpPct)}</td>
        <td class="right">${pct(t.muPct)}</td>
      </tr>
    `);
  }
}

$("cost").addEventListener("input",()=>{
  const cost=n($("cost").value);
  if(cost){
    $("rrpInc").value=(cost*DEFAULT_MULTIPLIER).toFixed(2);
  }
  update();
});

$("rrpInc").addEventListener("input",update);

document.querySelectorAll(".stepBtns button").forEach(btn=>{
  btn.addEventListener("click",()=>{
    const step=Number(btn.dataset.step);
    const r=n($("rrpInc").value)||0;
    $("rrpInc").value=(r+step).toFixed(2);
    update();
  });
});

$("gpTableBody").addEventListener("pointerdown",e=>{
  const row=e.target.closest("tr");
  if(!row) return;
  document.querySelectorAll("#gpTableBody tr").forEach(r=>r.classList.remove("tapped"));
  row.classList.add("tapped");
});

$("tableScroll").addEventListener("scroll",()=>{
  if($("tableScroll").scrollTop>0)
    $("tableScroll").classList.add("scrolling");
  else
    $("tableScroll").classList.remove("scrolling");
});
</script>

</body>
</html>